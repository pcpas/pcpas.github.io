---
title: æœåŠ¡å™¨é…ç½®ä¸å®éªŒè‡ªåŠ¨åŒ–é€ŸæŸ¥è¡¨
date: 2025-12-10 17:28:26
excerpt: ç§‘ç ”åˆæœŸæœ€æ€æ—¶é—´çš„å¾€å¾€ä¸æ˜¯è¯» Paperï¼Œè€Œæ˜¯é…ç¯å¢ƒã€ä¼ æ•°æ®å’Œå†™è„šæœ¬ã€‚ä¸å…¶æ¯æ¬¡é‡åˆ°é—®é¢˜ç°æŸ¥ï¼Œä¸å¦‚æ•´ç†ä¸€å¥—æ ‡å‡†åŒ–çš„ workflowã€‚
categories: [æŠ€æœ¯, äººå·¥æ™ºèƒ½]
tags: [æœåŠ¡å™¨é…ç½®]
---


# ğŸ“ æœåŠ¡å™¨é…ç½®ä¸å®éªŒè‡ªåŠ¨åŒ–é€ŸæŸ¥è¡¨

> **å‰è¨€**ï¼šç§‘ç ”åˆæœŸæœ€æ€æ—¶é—´çš„å¾€å¾€ä¸æ˜¯è¯» Paperï¼Œè€Œæ˜¯é…ç¯å¢ƒã€ä¼ æ•°æ®å’Œå†™è„šæœ¬ã€‚ä¸å…¶æ¯æ¬¡é‡åˆ°é—®é¢˜ç°æŸ¥ï¼Œä¸å¦‚æ•´ç†ä¸€å¥—æ ‡å‡†åŒ–çš„ workflowã€‚ä»¥ä¸‹æ˜¯æˆ‘å¸¸ç”¨çš„æœåŠ¡å™¨é…ç½®æ¸…å•ï¼Œæ—¨åœ¨ç”¨æœ€å°‘çš„å‘½ä»¤è§£å†³æœ€è„çš„æ´»ã€‚

## 1\. SSH é…ç½®ï¼šå‘Šåˆ«ç¹ççš„ IP è¾“å…¥

é€šè¿‡é…ç½® `~/.ssh/config`ï¼Œå¯ä»¥ä½¿ç”¨åˆ«åå¿«é€Ÿç™»å½•ã€‚
å¦‚æœä½ ä½¿ç”¨vscodeæˆ–ç±»ä¼¼ideï¼Œä¹Ÿå¯ä»¥ç›´æ¥è¿›è¡Œå¦‚ä¸‹é…ç½®ï¼Œå¾ˆæ–¹ä¾¿ã€‚

**æ–‡ä»¶è·¯å¾„**ï¼š`~/.ssh/config`

```bash
# å®éªŒå®¤æœåŠ¡å™¨ A
Host lab-server-1
  HostName 192.168.1.101  # æ›¿æ¢ä¸ºå®é™…IP
  Port 8001
  User myuser             # æ›¿æ¢ä¸ºä½ çš„ç”¨æˆ·å
  IdentityFile ~/.ssh/id_rsa_lab  # æŒ‡å®šç§é’¥ï¼Œå…å¯†ç™»å½•å¿…å¤‡

# å®éªŒå®¤æœåŠ¡å™¨ B (è·³æ¿æœºç¤ºä¾‹)
Host lab-server-2
  HostName 192.168.1.102
  Port 22
  User myuser
```

**ä½¿ç”¨æ–¹å¼**ï¼š
`ssh lab-server-1` å³å¯ç›´æ¥è¿æ¥ã€‚

-----

## 2\. ç¯å¢ƒç®¡ç†ï¼šæ— sudoæƒé™æ—¶çµæ´»åˆ‡æ¢ CUDA ä¸ GCC

åœ¨æ²¡æœ‰ `root` æƒé™ä¸”ä¸åŒé¡¹ç›®ä¾èµ–ä¸åŒç‰ˆæœ¬ GCC/CUDA æ—¶ï¼Œ**ç¯å¢ƒå˜é‡**æ˜¯æœ€å®‰å…¨çš„è§£å†³æ–¹æ¡ˆã€‚

### ä¿®æ”¹ CUDA ç‰ˆæœ¬

å‡è®¾æœåŠ¡å™¨åœ¨ `/usr/local/` ä¸‹è£…äº†å¤šä¸ª CUDA ç‰ˆæœ¬ï¼š

```bash
# ä¸´æ—¶åˆ‡æ¢ä¸º CUDA 11.8
export CUDA_HOME=/usr/local/cuda-11.8
export PATH="${CUDA_HOME}/bin:$PATH"
export LD_LIBRARY_PATH="${CUDA_HOME}/lib64:$LD_LIBRARY_PATH"

# éªŒè¯
nvcc --version
```

### ä¿®æ”¹ GCC/G++ ç‰ˆæœ¬

å¾ˆå¤šæ—§ä»£ç ï¼ˆå¦‚ NeRF ç›¸å…³ï¼‰ç¼–è¯‘æ—¶ä¸¥æ ¼ä¾èµ– GCC ç‰ˆæœ¬ã€‚ä¸è¦è¦†ç›–ç³»ç»Ÿ GCCï¼Œå»ºè®®ä½¿ç”¨ alias æˆ–ä¸´æ—¶å˜é‡ï¼š

```bash
# æŸ¥çœ‹ç³»ç»Ÿæœ‰å“ªäº› GCC
ls /usr/bin/gcc*

# ä¸´æ—¶åˆ‡æ¢æ–¹æ¡ˆ (å†™å…¥è„šæœ¬ `env_gcc10.sh`ï¼Œä½¿ç”¨æ—¶ source env_gcc10.sh)
export PATH=/usr/bin:$PATH
alias gcc='/usr/bin/gcc-10'
alias g++='/usr/bin/g++-10'
export CC=/usr/bin/gcc-10
export CXX=/usr/bin/g++-10

# éªŒè¯
gcc --version
```

-----

## 3\. å†…ç½‘ç©¿é€ï¼šæœåŠ¡å™¨é€šè¿‡æœ¬åœ°ä»£ç†ä¸Šç½‘

æœåŠ¡å™¨é€šå¸¸æ— æ³•ç›´æ¥è®¿é—® GitHub æˆ– HuggingFaceã€‚åˆ©ç”¨ SSH çš„**è¿œç¨‹ç«¯å£è½¬å‘ï¼ˆ-Rï¼‰**ï¼Œå¯ä»¥è®©æœåŠ¡å™¨èµ°æœ¬åœ°ç”µè„‘çš„ä»£ç†ã€‚

**æœ¬åœ°ç»ˆç«¯æ‰§è¡Œ**ï¼š

```bash
# å°†æœåŠ¡å™¨çš„ 50997 ç«¯å£æ˜ å°„åˆ°æœ¬åœ°çš„ 7890 (Clash/v2ray é»˜è®¤ç«¯å£)
ssh -p 8001 -R 50997:localhost:7890 myuser@192.168.1.101
```

**æœåŠ¡å™¨ç«¯æ‰§è¡Œ**ï¼š

```bash
# ä¸´æ—¶å¯ç”¨ä»£ç†
export http_proxy=http://127.0.0.1:50997
export https_proxy=http://127.0.0.1:50997

# æµ‹è¯•
curl -I https://www.google.com
```

*æ³¨ï¼šç«¯å£å· `50997` å»ºè®®é€‰ä¸€ä¸ªé«˜ä½å†·é—¨ç«¯å£ï¼Œé¿å…å†²çªã€‚*

-----

## 4\. Dockerï¼šç¯å¢ƒéš”ç¦»

å¯¹äºæå…¶éš¾é…çš„ç¯å¢ƒï¼ŒDocker å¯ä»¥å¾ˆæ–¹ä¾¿çš„è§£å†³ã€‚

**å¸¸ç”¨å¯åŠ¨å‘½ä»¤**ï¼š

```bash
docker run -id \
  --gpus all \
  --network=host \
  --name container_name \
  -v /home/myuser/data:/workspace/data \  # æŒ‚è½½æ•°æ®ç›˜
  -v /home/myuser/.cache:/root/.cache \   # æŒ‚è½½ç¼“å­˜ï¼Œé¿å…é‡å¤ä¸‹è½½æ¨¡å‹
  my-image:latest \
  /bin/bash
```

**è§£å†³ Docker å†…æ–‡ä»¶æƒé™é—®é¢˜**ï¼š
å¦‚æœä¸å¸Œæœ› Docker ç”Ÿæˆçš„æ–‡ä»¶åœ¨å®¿ä¸»æœºä¸Šå˜æˆ `root` æƒé™ï¼ˆå¯¼è‡´æ— æ³•ä¿®æ”¹ï¼‰ï¼Œéœ€åœ¨å®¹å™¨å†…åˆ›å»ºåŒ ID ç”¨æˆ·ï¼š

```bash
# åœ¨å®¹å™¨å†…éƒ¨æ‰§è¡Œ
groupadd -g 1001 mygroup  # 1001 æ›¿æ¢ä¸ºå®¿ä¸»æœº id -g
useradd -u 1001 -g 1001 -m myuser # 1001 æ›¿æ¢ä¸ºå®¿ä¸»æœº id -u
su myuser
```

-----

## 5\. æ•°æ®ä¼ è¾“ä¸å­˜å‚¨ä¼˜åŒ–

### SCP å¸¸ç”¨æ¨¡æ¿

```bash
# ä¸Šä¼ ï¼šæœ¬åœ° -> æœåŠ¡å™¨
scp -P 8001 -r ./local_folder myuser@192.168.1.101:/home/myuser/data/

# ä¸‹è½½ï¼šæœåŠ¡å™¨ -> æœ¬åœ°
scp -P 8001 -r myuser@192.168.1.101:/home/myuser/output/ ./
```

### è½¬ç§» PIP/Conda ç¼“å­˜

æœåŠ¡å™¨çš„ `/home` ç›®å½•é€šå¸¸é…é¢å¾ˆå°ï¼Œè·‘å‡ ä¸ªå®éªŒå Conda ç¯å¢ƒå’Œ Pip ç¼“å­˜å°±èƒ½æŠŠå®ƒå¡æ»¡ã€‚ä¸ä»…è¦ä¼šå»ºç«‹è½¯è¿æ¥ï¼Œæ›´è¦å½»åº•ä¿®æ”¹é»˜è®¤çš„ç¼“å­˜è·¯å¾„ã€‚

#### å»ºç«‹æ•°æ®ç›˜è½¯è¿æ¥


```bash
# è¯­æ³•ï¼šln -s <ç›®æ ‡å®é™…è·¯å¾„> <å½“å‰ç›®å½•ä¸‹çš„é“¾æ¥å>
# ç¤ºä¾‹ï¼šå°† /data/å¤§å®¹é‡ç›˜/æˆ‘çš„æ•°æ® æ˜ å°„ä¸º ./storage
ln -s /path/to/actual/big_storage/data ./storage
```

#### è¿ç§» Conda/Pip ç¼“å­˜

**Conda é…ç½®**
ç¼–è¾‘ `~/.condarc` æ–‡ä»¶ï¼Œæ·»åŠ  `pkgs_dirs` æŒ‡å®šåŒ…çš„ä¸‹è½½è·¯å¾„ï¼š

```yaml
pkgs_dirs:
  - /path/to/your/custom/conda_pkgs
```

**Pip é…ç½®**
ç¼–è¾‘ `~/.bashrc` (æˆ– `~/.zshrc`)ï¼Œæ·»åŠ ç¯å¢ƒå˜é‡ï¼š

```bash
export PIP_CACHE_DIR=/path/to/your/custom/pip_cache
```

*ä¿®æ”¹åè®°å¾— source ä¸€ä¸‹é…ç½®æ–‡ä»¶ã€‚*

#### éªŒè¯ä¸æ¸…ç† 

```bash
# --- éªŒè¯é…ç½®æ˜¯å¦ç”Ÿæ•ˆ ---
conda config --show pkgs_dirs
pip cache info

# æ¸…é™¤æœªä½¿ç”¨çš„åŒ…å’Œç¼“å­˜
conda clean --all
# æ¸…é™¤ pip ä¸‹è½½ç¼“å­˜
pip cache purge
```

-----

## 6\. ç®€æ˜“è‡ªåŠ¨åŒ–è®­ç»ƒè„šæœ¬

è¿™æ˜¯ä¸€ä¸ªç®€å•çš„ Bash è„šæœ¬ï¼Œç”¨äºè½®è¯¢ GPU å¹¶è‡ªåŠ¨è·‘å®éªŒã€‚
**æ³¨æ„**ï¼šæ­¤è„šæœ¬ä»…é€‚ç”¨äºå•äººç‹¬å æˆ–èµ„æºè¾ƒä¸ºç©ºé—²çš„æœåŠ¡å™¨ã€‚å¦‚æœå¤šäººå…±ç”¨ï¼Œè¯¥è„šæœ¬çš„ç®€å•çš„æ˜¾å­˜åˆ¤æ–­é€»è¾‘ (`nvidia-smi` ç¬æ—¶å€¼) å¯èƒ½ä¼šå¯¼è‡´èµ„æºç«äº‰ã€‚

```bash
#!/bin/bash

DATA_ROOT="/path/to/dataset" # ä¿®æ”¹ä¸ºç»å¯¹è·¯å¾„
OUTPUT_DIR="output_logs"
DATASETS=("dataset_A")
SCENES=("scene_01" "scene_02")

# è·å–ç©ºé—² GPU çš„å‡½æ•° (é˜ˆå€¼è®¾ä¸º 500MB)
get_available_gpu() {
    local mem_threshold=500
    # æ³¨æ„ï¼šè¿™é‡Œä¾èµ– nvidia-smi çš„è¾“å‡ºæ ¼å¼ï¼Œä¸åŒé©±åŠ¨ç‰ˆæœ¬å¯èƒ½éœ€å¾®è°ƒ
    nvidia-smi --query-gpu=index,memory.used --format=csv,noheader,nounits | \
    awk -v threshold="$mem_threshold" -F', ' '$2 < threshold { print $1; exit }'
}

run_task() {
    local GPU_ID=$1
    local SCENE=$2
    
    echo "Running ${SCENE} on GPU ${GPU_ID}..."
    
    # ä½ çš„æ ¸å¿ƒè®­ç»ƒå‘½ä»¤
    CUDA_VISIBLE_DEVICES=${GPU_ID} python train.py \
        -s ${DATA_ROOT}/${SCENE} \
        -m ${OUTPUT_DIR}/${SCENE} \
        > ${OUTPUT_DIR}/${SCENE}.log 2>&1
}

# ä¸»å¾ªç¯
mkdir -p ${OUTPUT_DIR}
for SCENE in "${SCENES[@]}"; do
    GPU_ID=$(get_available_gpu)
    
    # é˜»å¡ç›´åˆ°æœ‰å¡ç©ºé—²
    while [ -z "$GPU_ID" ]; do
        echo "Waiting for GPU..."
        sleep 60
        GPU_ID=$(get_available_gpu)
    done

    # åå°è¿è¡Œä»»åŠ¡
    (run_task $GPU_ID "$SCENE") &
    
    # ç®€å•é˜²å†²çªå»¶æ—¶
    sleep 10
done

wait
echo "All tasks finished."
```


-----


## 7\. ç»ˆç«¯å¤ç”¨ï¼šTmux

**ç—›ç‚¹**ï¼šSSH è¿æ¥ä¸€æ—¦æ–­å¼€ï¼ˆç½‘ç»œæ³¢åŠ¨æˆ–æœ¬åœ°å…³æœºï¼‰ï¼Œæ­£åœ¨è¿è¡Œçš„è®­ç»ƒè„šæœ¬ä¼šè¢«ç³»ç»Ÿæ”¶åˆ° `SIGHUP` ä¿¡å·å¼ºåˆ¶æ€æ‰ã€‚
**è§£æ³•**ï¼šä½¿ç”¨ `tmux` å°†ä¼šè¯è¿è¡Œåœ¨æœåŠ¡å™¨åå°ï¼Œå³ä¾¿æ–­å¼€è¿æ¥ï¼Œä»»åŠ¡ä¾ç„¶åœ¨è·‘ï¼Œä¸‹æ¬¡è¿ä¸Šå»è¿˜èƒ½çœ‹åˆ°è¿›åº¦æ¡ã€‚

### å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥

```bash
# 1. æ–°å»ºä¸€ä¸ªå…·åä¼šè¯ï¼ˆæ¨èç”¨æœ‰æ„ä¹‰çš„åå­—ï¼Œå¦‚ lab_bertï¼‰
tmux new -s lab_bert

# 2. æš‚æ—¶ç¦»å¼€ä¼šè¯ï¼ˆç¨‹åºç»§ç»­åœ¨åå°è·‘ï¼‰
# å¿«æ·é”®ï¼šå…ˆæŒ‰ Ctrl + Bï¼Œæ¾å¼€åæŒ‰ D (Detach)

# 3. æŸ¥çœ‹å½“å‰æœ‰å“ªäº›ä¼šè¯
tmux ls

# 4. æ¢å¤ï¼ˆé‡è¿ï¼‰æŸä¸ªä¼šè¯
tmux attach -t lab_bert

# 5. åˆ é™¤ä¼šè¯
tmux kill-session -t lab_bert
```

### å¿…å¤‡é…ç½®ï¼šå¼€å¯é¼ æ ‡ä¸æ»šè½®

åŸç”Ÿ Tmux æœ€å¤§çš„åç›´è§‰ä¹‹å¤„åœ¨äº**æ— æ³•ä½¿ç”¨é¼ æ ‡æ»šè½®æŸ¥çœ‹å†å²è¾“å‡º**ï¼Œä¸”é€‰ä¸­æ–‡å­—å¾ˆéº»çƒ¦ã€‚å»ºè®®åœ¨ `~/.tmux.conf` ä¸­åŠ å…¥ä»¥ä¸‹é…ç½®ï¼š

```bash
# æ–‡ä»¶è·¯å¾„ï¼š~/.tmux.conf

# å¼€å¯é¼ æ ‡æ”¯æŒï¼ˆç‚¹å‡»åˆ‡æ¢çª—å£ã€æ‹–åŠ¨æ”¹å˜å¤§å°ã€æ»šè½®ç¿»é¡µï¼‰
set -g mouse on

# å¢åŠ å†å²å›æ»šè¡Œæ•°ï¼ˆé»˜è®¤å¾ˆçŸ­ï¼Œè·‘è®­ç»ƒä¸å¤Ÿçœ‹æ—¥å¿—ï¼‰
set -g history-limit 10000
```

**ç”Ÿæ•ˆé…ç½®**ï¼š
åœ¨ç»ˆç«¯æ‰§è¡Œ `tmux source ~/.tmux.conf` å³å¯ç”Ÿæ•ˆã€‚

> **æ³¨**ï¼šå¼€å¯é¼ æ ‡æ¨¡å¼åï¼Œå¦‚æœéœ€è¦å¤åˆ¶ç»ˆç«¯é‡Œçš„æ–‡æœ¬ï¼Œé€šå¸¸éœ€è¦æŒ‰ä½ `Shift` é”®å†ç”¨é¼ æ ‡é€‰æ‹©å¤åˆ¶ã€‚

-----
