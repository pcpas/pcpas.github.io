---
title: è¯æ³•åˆ†æ
date: 2023-09-20 20:57:21
excerpt: ä»é›¶å¼€å§‹çš„ç¼–è¯‘å™¨ä¹‹è¯æ³•åˆ†æ
categories: [æŠ€æœ¯, ç¼–è¯‘æŠ€æœ¯]
tags: [è¯æ³•åˆ†æ]
topic: compiler
---

# è¯æ³•åˆ†æ

## æ€»ä½“ç»“æ„

åœ¨ä¸Šæ¬¡çš„åŸºç¡€ä¸Šä¸»è¦æ–°å¢ä¸‰ä¸ªç±»ï¼š`Tokens`ã€`Tokenizer`å’Œ`Scanner`ã€‚

ç›®å‰çš„æ–‡ä»¶æ ‘é•¿è¿™æ ·ï¼š

```
-MyCompiler
  - Frontend
    - exception
    	-SysException.java
    - Factory.java
    - Tokens.java
    - Tokenizer.java
    - Scanner.java
  - Backend
  - Compiler.java
```

### Tokens

Tokensæ˜¯ä¸€ä¸ªä»£è¡¨Tokençš„ç±»ï¼Œæœ‰ä¸¤ä¸ªå†…éƒ¨ç±»ï¼Œä¸€ä¸ªæ˜¯ä»£è¡¨Tokenç±»å‹çš„æšä¸¾ç±»TokenKindï¼Œå¦ä¸€ä¸ªæ˜¯ä»£è¡¨ä¸€ä¸ªTokenå¯¹è±¡çš„Tokenç±»ã€‚

å…¶ä¸­ï¼š

```java
public class Tokens {
		//Tokensç±»ä¸­ä¼šå£°æ˜ä¸€äº›å·¥å…·æ–¹æ³•æ¥è¾…åŠ©è¯æ³•åˆ†æçš„è¿›è¡Œï¼Œå¦‚ï¼š
  
  	//isExistï¼šæŸ¥è¯¢tokenNameæ˜¯å¦æ˜¯Tokenå…³é”®è¯
  	public boolean isExist(String tokenName) {...}
		...
      
    //define ALL kinds of token
    public enum TokenKind {
        IDENT("Ident", "IDENFR"),
        INTCONST("IntConst", "INTCON"),
        FMTSTRING("FormatString", "STRCON"),
      	//...
      
				private final String name;
        private final String tag;
    }
		
  	//Tokenå®ä½“ç±»
    public static class Token implements Unit{
        //...
    }
}
```

å…¶ä¸­Tokenç±»æ‰¿è½½äº†æœ€å¤šçš„åŠŸèƒ½ï¼š

```java
public static class Token implements Unit{
        private TokenKind kind = null;
        private String identValue = null;
        private Integer lineLocated = null;

				//ä¸åŒçš„æ„é€ å‡½æ•°å¯¹åº”ä¸åŒç±»å‹çš„Tokenåˆ›å»ºæ–¹æ³•
  			
  			//å¯¹äºtokenNameå’ŒTokenKindç›´æ¥åŒ¹é…çš„æƒ…å†µï¼Œå¯ä»¥ç›´æ¥è¯†åˆ«ï¼Œä¸éœ€è¦å†switch
				public Token(String tokenName, Integer lineLocated) {}
        public Token(TokenKind kind, Integer lineLocated) {}
        public Token(TokenKind kind, String identValue, Integer lineLocated) {}
  
  			//æ­¤å¤–è¿˜æœ‰ä¸€äº›getã€setæ¥å£æä¾›Tokençš„å¯¹å¤–è®¿é—®
        ...
    }
```

å¤šæ ·åŒ–çš„Tokenæ„é€ æ–¹æ³•å¯ä»¥å…è®¸æˆ‘ä»¬ä¾¿æ·åœ°è¯†åˆ«ç”ŸæˆTokenï¼Œä¸ºæ¥ä¸‹æ¥çš„è¯æ³•åˆ†æå·¥ä½œæä¾›ä¾¿åˆ©ã€‚

### Tokenizer

`Tokenizer`æ˜¯è¿›è¡Œè¯æ³•åˆ†æçš„ç±»ã€‚ç»“åˆæˆ‘ä»¬ç”»çš„çŠ¶æ€è½¬ç§»å›¾ç¼–å†™åˆé€‚çš„è¯æ³•åˆ†æå‡½æ•°ï¼Œä»è€Œå®Œæˆè¯æ³•åˆ†æè¿™ä¸€è¿‡ç¨‹ï¼Œå¹¶å°†æ‰€æœ‰Tokenå­˜æ”¾åœ¨Scannerä¸­ã€‚

```java
public class Tokenizer {
    private final Tokens tokens;//tokenså®šä¹‰äº†Token 
    private final Scanner scanner;//è¯æ³•åˆ†æå‡ºçš„tokensä¼šå­˜æ”¾åœ¨scannerä¸­
    private final BufferedReader bufferedReader;//å†™æ–‡ä»¶
    private final StringBuilder sb;//å¸®åŠ©æ„å»ºTokenå­—ç¬¦ä¸²
    private int charRead; //ä¿å­˜å½“å‰è¯»å…¥çš„å­—ç¬¦
    private int curLine;	//ä¿å­˜è¡Œå·

  	
    Tokenizer(Tokens tokens, Scanner scanner, BufferedReader bufferedReader) {...}

    private int next() throws IOException, SysYException {...}

    public void lexicalAnalyse() throws IOException {...}
  
  	//æ­¤å¤–è¿˜æœ‰è‹¥å¹²ç§æœ‰çš„å·¥å…·æ–¹æ³•æ¥è¾…åŠ©è¿›è¡Œè¯æ³•åˆ†æï¼Œè¿™é‡Œä¸ç»†è¯´äº†
  	...

}
```

### Scanner

`Scanner`æ˜¯ä¸€ä¸ªè¾…åŠ©ç±»ï¼Œä½œç”¨æ˜¯å­˜æ”¾è¯æ³•åˆ†æå¾—åˆ°çš„æ‰€æœ‰tokenï¼Œå¹¶åœ¨è¯­æ³•åˆ†æä¸­ç›´æ¥ä½¿ç”¨ã€‚

```java

public class Scanner {
    private final ArrayList<Tokens.Token> tokens = new ArrayList<>(); //å­˜æ”¾token
    private BufferedWriter bufferedWriter;  //è¾“å‡º
    private Tokens.Token token;  //å½“å‰çš„token
  
    public Scanner(BufferedWriter bufferedWriter) {...}

  	//åœ¨è¯æ³•åˆ†æä¸­å­˜æ”¾token
    public void putToken(Tokens.Token t) {...}

  
  	//åœ¨è¯­æ³•åˆ†æä¸­å–ç”¨token
  	//å°†é”™è¯¯å¤„ç†ç­‰å¤æ‚æ€§éšè—åœ¨æ¥å£ä¸­ï¼Œç®€åŒ–ä»£ç 
    public Tokens.Token next(){...}

    public Tokens.Token lookAhead(int s){...}
  
    public Tokens.Token getToken(){...}

    public void printAllTokens() throws IOException {...}

}

```

## çŠ¶æ€è½¬ç§»å›¾

`Tokenizer`çš„ä¸»å‡½æ•°ç¼–å†™éœ€è¦å€ŸåŠ©ä¸€ä¸ªå®Œæ•´çš„çŠ¶æ€è½¬ç§»å›¾ã€‚æ‰€ä»¥è¯æ³•åˆ†ææœ€é‡è¦çš„æ˜¯ç”»çŠ¶æ€å›¾ï¼ŒæŠŠçŠ¶æ€è½¬ç§»å›¾ç”»å‡ºæ¥äº†ï¼Œå†™ä»£ç å°±éå¸¸æ„‰å¿«äº†ï¼ğŸ˜„

![](https://zzq-typora-picgo.oss-cn-beijing.aliyuncs.com/Image/image-20230919213836456.png)

## æ€»ç»“

è¿™æ¬¡å®éªŒè¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œä½†æ˜¯éœ€è¦æˆ‘ä»¬ä¸€å¼€å§‹æŠŠæ¡†æ¶æ­å¥½ï¼å¸Œæœ›ä¹‹åä¸ä¼šåå¤é‡æ„å§ï½ï½
